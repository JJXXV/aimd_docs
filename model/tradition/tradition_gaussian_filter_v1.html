<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>5.7.1. tradition_gaussian_filter_v1 &mdash; Title</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/table_styling.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom_rtd.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script src="../../_static/js/aimd.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="6. C API" href="../../c_api.html" />
    <link rel="prev" title="5.7. 传统算法模型" href="index.html" />
     
    <script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:1074732,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
    </script>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PX5BPGW');</script>
    <!-- End Google Tag Manager -->

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

  
  <a href="https://www.infirayoutdoor.cn/" class="icon icon-home" title="Back to Documents Home"><img src="../../_static/aimd-html.png" class="logo" alt="Logo"/></a>


<div class="homelink"><a href="../../index.html">AIMD USER GUIDE</a></div>


  
  
    <div class="version">
      Version: 0.0.3.dev0+g78b1812.d20240531
    </div>
  



<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">1. 简介</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../overview.html#id2">1.1. 背景</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview.html#id3">1.2. 架构</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview.html#id4">1.3. 使用流程</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">2. 安装</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#gitlab">2.1. Gitlab 直接下载库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#id2">2.2. 源码编译库</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../installation.html#docker">2.2.1. Docker 下载</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../installation.html#id3">2.2.2. 源码下载</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../installation.html#id4">2.2.3. 交叉编译</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#id5">2.3. 模型文件下载</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#id6">2.4. 运行时依赖库</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../quick_start.html">3. 快速开始</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../quick_start.html#id2">3.1. 部署代码</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../quick_start.html#id3">3.1.1. 主要接口介绍</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../quick_start.html#id4">3.1.2. 代码流程</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../quick_start.html#cmake">3.2. cmake 代码</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quick_start.html#id5">3.3. 编译 &amp; 运行</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quick_start.html#id6">3.4. 结果</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../model_index.html">4. 模型索引</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">5. 模型文档</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../classification/index.html">5.1. 分类模型</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../detection/index.html">5.2. 检测模型</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reid/index.html">5.3. reid 模型</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../seg/index.html">5.4. 分割模型</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../sr/index.html">5.5. 超分模型</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../track/index.html">5.6. 跟踪模型</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">5.7. 传统算法模型</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">5.7.1. tradition_gaussian_filter_v1</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">模型简介</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">模型更新历史</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">模型部署</a></li>
<li class="toctree-l4"><a class="reference internal" href="#test-code">TEST CODE</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../c_api.html">6. C API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../develop/index.html">7. 开发者文档</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../develop/arch.html">7.1. 平台架构</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../develop/backend.html">7.2. 新增芯片后端</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../develop/deploy.html">7.3. 新增模型</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../legal.html">8. Copyright</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">AIMD USER GUIDE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tradition-gaussian-filter-v1">
<h1><span class="section-number">5.7.1. </span>tradition_gaussian_filter_v1<a class="headerlink" href="#tradition-gaussian-filter-v1" title="Permalink to this headline"></a></h1>
<section id="id1">
<h2>模型简介<a class="headerlink" href="#id1" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>作用：将传统高斯滤波转换成模型的形式，并使用 NPU 进行计算，提高传统高斯滤波的计算速度</p></li>
<li><p>模型作者：王京</p></li>
<li><p>适用场景：对任意图片进行高斯滤波，基本都可以使用这种方式优化</p></li>
<li><p>实际效果：</p></li>
</ul>
<figure class="align-center" id="gaussian-filter">
<a class="reference internal image-reference" href="../../_images/tradition_gaussian_filter_perform.png"><img alt="../../_images/tradition_gaussian_filter_perform.png" src="../../_images/tradition_gaussian_filter_perform.png" style="width: 80%;" /></a>
</figure>
<ul class="simple">
<li><dl class="simple">
<dt>补充说明：</dt><dd><ul>
<li><p>理论上可以对任意格式(RGB/BGR/GRAY等)、任意尺寸图片进行高斯滤波的优化，但是需要重新生成模型文件</p></li>
<li><dl class="simple">
<dt>传统高斯滤波和模型推理的结果并不是完全一致的(大概平均像素误差在 0.5 以下)，存在两方面误差</dt><dd><ul>
<li><p>fp32 计算和 int8 计算的误差</p></li>
<li><p>最外层像素 padding 方式不同，传统高斯滤波使用最外层像素值进行 padding，模型使用 0 进行 padding，这个差异只会影响最外边一圈的计算结果</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="id2">
<h2>模型更新历史<a class="headerlink" href="#id2" title="Permalink to this headline"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>onnx input shape 是模型推理时，实际输入的尺寸，并不是部署时一定要提供这种尺寸。
一般情况下，如果外部提供的尺寸与 onnx input shape 不一致，AIMD 会在内部进行 resize
然后在输入到模型中进行推理。</p>
</div>
<table class="docutils align-default" id="id4" style="width: 100%">
<caption><span class="caption-number">Table 5.1 </span><span class="caption-text">模型更新历史</span><a class="headerlink" href="#id4" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>onnx model</p></th>
<th class="head"><p>onnx input shape</p></th>
<th class="head"><p>NPU model</p></th>
<th class="head"><p>NPU platform</p></th>
<th class="head"><p>模型说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>tradition_gaussian_filter_v1_20240523.onnx</p></td>
<td><p>1x1x512x640</p></td>
<td><p>tradition_gaussian_filter_v1_20240523.npubin</p></td>
<td><p>AR9341</p></td>
<td><p>对应传统高斯滤波：kernel size 为 3，sigma 为 0.8</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>RESERVE</p></td>
<td><p>RESERVE</p></td>
<td><p>RESERVE</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>RESERVE</p></td>
<td><p>RESERVE</p></td>
<td><p>RESERVE</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id3">
<h2>模型部署<a class="headerlink" href="#id3" title="Permalink to this headline"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li><p>模型速度：包含模型前后处理，加上 NPU 推理的全部速度。AIMD 测试时，仅仅运行部署代码，并没有其他进程、线程的影响，也就是说测试环境较为理想</p></li>
<li><p>模型大小：仅仅指模型文件大小，并不是指模型参数个数</p></li>
<li><dl>
<dt>模型量化损失：计算 FP32 模型和量化模型输出 tensor 的 MAE，这种方式可能不是最准确的，但是是最直观的，公式如下：</dt><dd><div class="math notranslate nohighlight">
\[\text{量化损失(MAE)} = \frac{1}{n}\sum_{i=1}^{n} |y_i - \hat{y_i}|\]</div>
</dd>
</dl>
</li>
<li><p>模型部署代码：为了防止参数细节引起的 bug，请参考测试代码进行部署，测试代码都是通过单元测试的代码</p></li>
</ul>
</div>
<table class="docutils align-default" id="id5" style="width: 100%">
<caption><span class="caption-number">Table 5.2 </span><span class="caption-text">模型部署</span><a class="headerlink" href="#id5" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>NPU model</p></th>
<th class="head"><p>模型精度</p></th>
<th class="head"><p>模型速度</p></th>
<th class="head"><p>模型大小</p></th>
<th class="head"><p>模型量化损失</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>tradition_gaussian_filter_v1_20240523.npubin</p></td>
<td><p>int8</p></td>
<td><p>15ms</p></td>
<td><p>38KB</p></td>
<td><p>0.29</p></td>
</tr>
<tr class="row-odd"><td><p>RESERVE</p></td>
<td><p>RESERVE</p></td>
<td><p>RESERVE</p></td>
<td><p>RESERVE</p></td>
<td><p>RESERVE</p></td>
</tr>
</tbody>
</table>
</section>
<section id="test-code">
<h2>TEST CODE<a class="headerlink" href="#test-code" title="Permalink to this headline"></a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="c1">// Copyright (c) 2024 烟台艾睿光电科技有限公司 All rights reserved.</span>
<span class="linenos">  2</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;aimd_c_types.h&quot;</span>
<span class="linenos">  3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;aimd_header.h&quot;</span>
<span class="linenos">  4</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;catch2/catch.hpp&quot;</span>
<span class="linenos">  5</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;opencv2/opencv.hpp&quot;</span>
<span class="linenos">  6</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;tradition_gaussian_filter_v1_types.h&quot;</span>
<span class="linenos">  7</span>
<span class="linenos">  8</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cmath&gt;</span>
<span class="linenos">  9</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cstring&gt;</span>
<span class="linenos"> 10</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="linenos"> 11</span>
<span class="linenos"> 12</span><span class="c1">// 高斯滤波 CPU 实现，用于与 NPU 结果进行比对</span>
<span class="linenos"> 13</span><span class="kt">int</span><span class="w"> </span><span class="nf">separateGaussianFilter</span><span class="p">(</span>
<span class="linenos"> 14</span><span class="w">    </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">dst</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">wsize</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">sigma</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 15</span><span class="w">    </span><span class="c1">//获取一维高斯滤波模板</span>
<span class="linenos"> 16</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">window</span><span class="p">;</span>
<span class="linenos"> 17</span><span class="w">    </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">dstT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">width</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span>
<span class="linenos"> 18</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dstT</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="linenos"> 19</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos"> 20</span><span class="w">    </span><span class="n">window</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">wsize</span><span class="p">);</span>
<span class="linenos"> 21</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">center</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">wsize</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="linenos"> 22</span><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="linenos"> 23</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">wsize</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 24</span><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">pow</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">center</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sigma</span><span class="p">));</span>
<span class="linenos"> 25</span><span class="w">        </span><span class="n">window</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="p">;</span>
<span class="linenos"> 26</span><span class="w">        </span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">g</span><span class="p">;</span>
<span class="linenos"> 27</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 28</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">wsize</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 29</span><span class="w">        </span><span class="n">window</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">sum</span><span class="p">;</span>
<span class="linenos"> 30</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 31</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">boder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">wsize</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="linenos"> 32</span><span class="w">    </span><span class="c1">//高斯滤波--水平方向</span>
<span class="linenos"> 33</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">height</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 34</span><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">width</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 35</span><span class="w">            </span><span class="kt">float</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 36</span><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">boder</span><span class="p">;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">boder</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 37</span><span class="w">                </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">+</span>
<span class="linenos"> 38</span><span class="w">                      </span><span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)]</span><span class="w"> </span><span class="o">*</span>
<span class="linenos"> 39</span><span class="w">                          </span><span class="n">window</span><span class="p">[</span><span class="n">r</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">boder</span><span class="p">];</span>
<span class="linenos"> 40</span><span class="w">            </span><span class="p">}</span>
<span class="linenos"> 41</span><span class="w">            </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">sum</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span><span class="w"> </span><span class="kt">float</span><span class="p">(</span><span class="mi">255</span><span class="p">));</span>
<span class="linenos"> 42</span><span class="w">            </span><span class="n">dstT</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="p">;</span>
<span class="linenos"> 43</span><span class="w">        </span><span class="p">}</span>
<span class="linenos"> 44</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 45</span><span class="w">    </span><span class="c1">//高斯滤波--垂直方向</span>
<span class="linenos"> 46</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">height</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 47</span><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">width</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 48</span><span class="w">            </span><span class="kt">float</span><span class="w"> </span><span class="n">sum</span><span class="p">;</span>
<span class="linenos"> 49</span><span class="w">            </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 50</span><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">boder</span><span class="p">;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">boder</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 51</span><span class="w">                </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span>
<span class="linenos"> 52</span><span class="w">                    </span><span class="n">sum</span><span class="w"> </span><span class="o">+</span>
<span class="linenos"> 53</span><span class="w">                    </span><span class="n">dstT</span><span class="p">[</span><span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">*</span>
<span class="linenos"> 54</span><span class="w">                        </span><span class="n">window</span><span class="p">[</span><span class="n">r</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">boder</span><span class="p">];</span>
<span class="linenos"> 55</span><span class="w">            </span><span class="p">}</span>
<span class="linenos"> 56</span><span class="w">            </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">sum</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span><span class="w"> </span><span class="kt">float</span><span class="p">(</span><span class="mi">255</span><span class="p">));</span>
<span class="linenos"> 57</span><span class="w">            </span><span class="n">dst</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="p">;</span>
<span class="linenos"> 58</span><span class="w">        </span><span class="p">}</span>
<span class="linenos"> 59</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 60</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">dstT</span><span class="p">);</span>
<span class="linenos"> 61</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 62</span><span class="p">}</span>
<span class="linenos"> 63</span>
<span class="linenos"> 64</span><span class="cp">#ifdef AIMD_PLATFORM_AR9341</span>
<span class="linenos"> 65</span><span class="cp">#    ifdef AIMD_PLATFORM_AR9341_SDK_16_02</span>
<span class="linenos"> 66</span><span class="n">TEST_CASE</span><span class="p">(</span><span class="s">&quot;tradition_gaussian_filter_v1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;AR9341-SDK-16.02&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 67</span><span class="w">    </span><span class="c1">// 图片/模型 使用相对路径，从 src 开始</span>
<span class="linenos"> 68</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">img_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;./src/model/tradition/tradition_gaussian_filter_v1/&quot;</span>
<span class="linenos"> 69</span><span class="w">                           </span><span class="s">&quot;data/tradition_gaussian_filter.jpg&quot;</span><span class="p">;</span>
<span class="linenos"> 70</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">model_path</span><span class="w"> </span><span class="o">=</span>
<span class="linenos"> 71</span><span class="w">        </span><span class="s">&quot;./src/model/tradition/tradition_gaussian_filter_v1/&quot;</span>
<span class="linenos"> 72</span><span class="w">        </span><span class="s">&quot;tradition_gaussian_filter_v1_20240523.npubin&quot;</span><span class="p">;</span>
<span class="linenos"> 73</span>
<span class="linenos"> 74</span><span class="w">    </span><span class="c1">// 设置 EngineParam &amp; create Handle</span>
<span class="linenos"> 75</span><span class="w">    </span><span class="n">EngineParam</span><span class="w"> </span><span class="n">gaussianEngineParam</span><span class="p">;</span>
<span class="linenos"> 76</span><span class="w">    </span><span class="n">strcpy</span><span class="p">(</span><span class="n">gaussianEngineParam</span><span class="p">.</span><span class="n">modelType</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;tradition_gaussian_filter_v1&quot;</span><span class="p">);</span>
<span class="linenos"> 77</span><span class="w">    </span><span class="n">strcpy</span><span class="p">(</span><span class="n">gaussianEngineParam</span><span class="p">.</span><span class="n">modelPath</span><span class="p">,</span><span class="w"> </span><span class="n">model_path</span><span class="p">);</span>
<span class="linenos"> 78</span><span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AIMDCreateHandle</span><span class="p">(</span><span class="o">&amp;</span><span class="n">gaussianEngineParam</span><span class="p">);</span>
<span class="linenos"> 79</span>
<span class="linenos"> 80</span><span class="w">    </span><span class="c1">// 设置 ModelParam &amp; Init</span>
<span class="linenos"> 81</span><span class="w">    </span><span class="n">GaussianParams</span><span class="w"> </span><span class="n">modelParam</span><span class="p">;</span>
<span class="linenos"> 82</span><span class="w">    </span><span class="n">AIMDInit</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">modelParam</span><span class="p">);</span>
<span class="linenos"> 83</span>
<span class="linenos"> 84</span><span class="w">    </span><span class="c1">// 读取图片</span>
<span class="linenos"> 85</span><span class="w">    </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">imread</span><span class="p">(</span><span class="n">img_path</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">);</span>
<span class="linenos"> 86</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span>
<span class="linenos"> 87</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span>
<span class="linenos"> 88</span>
<span class="linenos"> 89</span><span class="w">    </span><span class="c1">// 运行传统高斯滤波(用于比对)，部署时不需要考虑下面的代码</span>
<span class="linenos"> 90</span><span class="w">    </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">cpuInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">float</span><span class="p">[</span><span class="n">height</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="p">];</span>
<span class="linenos"> 91</span><span class="w">    </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">cpuOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">float</span><span class="p">[</span><span class="n">height</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="p">];</span>
<span class="linenos"> 92</span><span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">imageData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">image</span><span class="p">.</span><span class="n">data</span><span class="p">;</span>
<span class="linenos"> 93</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">height</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">h</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 94</span><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">width</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">w</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 95</span><span class="w">            </span><span class="n">cpuInput</span><span class="p">[</span><span class="n">h</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">w</span><span class="p">]</span><span class="w"> </span><span class="o">=</span>
<span class="linenos"> 96</span><span class="w">                </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">imageData</span><span class="p">[</span><span class="n">h</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">w</span><span class="p">]);</span>
<span class="linenos"> 97</span><span class="w">        </span><span class="p">}</span>
<span class="linenos"> 98</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 99</span><span class="w">    </span><span class="n">separateGaussianFilter</span><span class="p">(</span><span class="n">cpuInput</span><span class="p">,</span><span class="w"> </span><span class="n">cpuOutput</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mf">0.8</span><span class="p">);</span>
<span class="linenos">100</span>
<span class="linenos">101</span><span class="w">    </span><span class="c1">// 运行 NPU 推理</span>
<span class="linenos">102</span><span class="w">    </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">npuOutput</span><span class="p">;</span>
<span class="linenos">103</span><span class="w">    </span><span class="n">AIMDRun</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">data</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">npuOutput</span><span class="p">);</span>
<span class="linenos">104</span>
<span class="linenos">105</span><span class="w">    </span><span class="c1">// 比对结果</span>
<span class="linenos">106</span><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">sumError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">107</span><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">meanError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">108</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">109</span><span class="w">        </span><span class="n">sumError</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">abs</span><span class="p">(</span><span class="n">npuOutput</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cpuOutput</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">110</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">111</span><span class="w">    </span><span class="n">meanError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sumError</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">height</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="p">);</span>
<span class="linenos">112</span>
<span class="linenos">113</span><span class="w">    </span><span class="c1">// 释放内存</span>
<span class="linenos">114</span><span class="w">    </span><span class="n">AIMDDestroy</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>
<span class="linenos">115</span><span class="w">    </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">cpuInput</span><span class="p">;</span>
<span class="linenos">116</span><span class="w">    </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">cpuOutput</span><span class="p">;</span>
<span class="linenos">117</span>
<span class="linenos">118</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;sum:   &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">sumError</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">119</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;mean:  &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">meanError</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">120</span><span class="w">    </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">meanError</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.4</span><span class="p">);</span>
<span class="linenos">121</span><span class="p">}</span>
<span class="linenos">122</span><span class="cp">#    endif </span><span class="c1">// AIMD_PLATFORM_AR9341_SDK_16_02</span>
<span class="linenos">123</span><span class="cp">#endif     </span><span class="c1">// AIMD_PLATFORM_AR9341</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="5.7. 传统算法模型" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../c_api.html" class="btn btn-neutral float-right" title="6. C API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
     
    <script id="hs-script-loader" async defer src="//js.hs-scripts.com/729091.js"></script>
    <script defer>
        if (typeof mutationObserver !== 'undefined')
            mutationObserver.observe(document.querySelector("div.rst-other-versions"), {childList: true, subtree: true})
        if (typeof updateDocumentLinks !== 'undefined')
            updateDocumentLinks()
        let search = document.querySelector("form#rtd-search-form > input[name='q']")
        if (document.location.pathname.startsWith("/projects/"))
          search.placeholder = "Search this document";
        else
          search.placeholder = "Search all documents";
    </script>


</body>
</html>